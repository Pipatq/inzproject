// let productList=[],userList=[],shoppingCart=[],currentPatientDetails={},transactionHistory=[],currentlyViewedTransaction=null,signaturePad=null,consultantSignatureBase64="",patientSignaturePad=null,patientSignatureBase64="";let historyCurrentPage=1;const historyPageSize=15;let allProductsCurrentPage=1;const allProductsPageSize=20;function formatCurrency(e,t=2){const a=parseFloat(e);return isNaN(a)?(0).toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2})+" บาท":a.toLocaleString("th-TH",{minimumFractionDigits:t,maximumFractionDigits:t})+" บาท"}function calculateAge(e){if(!e)return"N/A";try{const t=new Date(e),a=new Date().getFullYear(),n=t.getFullYear();if(isNaN(t.getTime())||n<1900||n>a||t.toISOString().substring(0,10)!==e)return"N/A";const o=new Date;let r=o.getFullYear()-n;const c=o.getMonth()-t.getMonth();return(c<0||0===c&&o.getDate()<t.getDate())&&r--,r>=0?r:"N/A"}catch(t){return console.error("Error calculating age for DOB:",e,t),"N/A"}}function updatePatientAgeDisplay(){const e=document.getElementById("patientDob"),t=document.getElementById("patientAge");if(!e||!t)return;const a=e.value,n=calculateAge(a);"N/A"!==n?(t.value=`${n} ปี`,e.dataset.displayAge=t.value):(t.value="",e.dataset.displayAge="N/A")}document.addEventListener("DOMContentLoaded",async()=>{addNotificationStyles(),await loadInitialData(),await loadTransactionHistory(),initSignaturePad(),initPatientSignaturePad();const e=document.getElementById("patientDob");e&&(e.addEventListener("change",updatePatientAgeDisplay),e.addEventListener("input",updatePatientAgeDisplay),updatePatientAgeDisplay()),setupLoginModal(),document.getElementById("patientType").addEventListener("change",renderAllProductsTable);const t=document.getElementById("firstName");t&&t.focus()});function initSignaturePad(){const e=document.getElementById("consultantSignatureCanvas");e?(signaturePad=new SignaturePad(e,{backgroundColor:"rgb(255, 255, 255)"}),resizeCanvas(signaturePad),window.addEventListener("resize",()=>resizeCanvas(signaturePad))):console.warn("Canvas 'consultantSignatureCanvas' not found.")}function initPatientSignaturePad(){const e=document.getElementById("patientSignatureCanvas");e?(patientSignaturePad=new SignaturePad(e,{backgroundColor:"rgb(255, 255, 255)"}),resizeCanvas(patientSignaturePad),window.addEventListener("resize",()=>resizeCanvas(patientSignaturePad))):console.warn("Canvas 'patientSignatureCanvas' not found.")}function resizeCanvas(e){if(!e)return;const t=e.canvas,a=Math.max(window.devicePixelRatio||1,1),n=t.offsetWidth*a,o=t.offsetHeight*a;if(t.width!==n||t.height!==o){const r=e.toData();t.width=n,t.height=o,t.getContext("2d").scale(a,a),e.clear(),e.fromData(r)}}function clearSignature(){if(signaturePad){signaturePad.clear(),consultantSignatureBase64="";const e=document.getElementById("consultantSignaturePreview");e&&(e.src="",e.style.display="none")}}function clearPatientSignature(){if(patientSignaturePad){patientSignaturePad.clear(),patientSignatureBase64="";const e=document.getElementById("patientSignaturePreview");e&&(e.src="",e.style.display="none")}}function saveSignature(){if(signaturePad&&!signaturePad.isEmpty()){consultantSignatureBase64=signaturePad.toDataURL("image/png");const e=document.getElementById("consultantSignaturePreview");e&&(e.src=consultantSignatureBase64,e.style.display="block"),showSuccessNotification("บันทึกลายเซ็นผู้ให้คำปรึกษาเรียบร้อย!")}else alert("กรุณาลงลายเซ็นผู้ให้คำปรึกษาก่อนบันทึกค่ะ")}function savePatientSignature(){if(patientSignaturePad&&!patientSignaturePad.isEmpty()){patientSignatureBase64=patientSignaturePad.toDataURL("image/png");const e=document.getElementById("patientSignaturePreview");e&&(e.src=patientSignatureBase64,e.style.display="block"),showSuccessNotification("บันทึกลายเซ็นผู้ป่วยเรียบร้อย!")}else alert("กรุณาลงลายเซ็นผู้ป่วยก่อนบันทึกค่ะ")}function addNotificationStyles(){const e=document.createElement("style");e.innerHTML=`
//         /* Styles for success notifications */
//         .success-notification {
//             position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
//             background-color: #28a745; color: white; padding: 16px 30px;
//             border-radius: 8px; z-index: 1001; font-size: 1.1em; font-weight: 500;
//             box-shadow: 0 4px 12px rgba(0,0,0,0.15); opacity: 0;
//             transition: top 0.5s ease, opacity 0.5s ease;
//         }
//         .success-notification.show { top: 80px; opacity: 1; }

//         /* General styles for search results */
//         .search-results .search-item {
//             padding: 10px;
//             cursor: pointer;
//             border-bottom: 1px solid #eee;
//             transition: background-color 0.2s;
//         }
//         .search-results .search-item:hover {
//             background-color: #f0f0f0;
//         }

//         /* Print styles */
//         @media print {
//             .no-print { display: none !important; }
//             body > *:not(.print-area) { display: none !important; }
//             .print-area { display: block !important; box-shadow: none; border: none; margin: 0; padding: 0; }
//             .signature-img { max-height: 40px; max-width: 180px; display: block; object-fit: contain; }
//             .signature { text-align: center; }
//         }
//     `,document.head.appendChild(e)}function showSuccessNotification(e){const t=document.createElement("div");t.className="success-notification",t.textContent=e,document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),500)},4e3)}async function loadInitialData(){try{const e=await fetch("/api/initial-data");if(!e.ok)throw new Error(`Server error: ${e.status}`);const t=await e.json();if(!t||!t.products||!t.users)throw new Error("Invalid data structure.");productList=t.products,userList=t.users,populateDropdowns(),renderAllProductsTable()}catch(e){console.error("CRITICAL ERROR loading initial data:",e),alert("ไม่สามารถโหลดข้อมูลเริ่มต้นได้ กรุณาตรวจสอบการเชื่อมต่อเซิร์ฟเวอร์")}}function populateDropdowns(){const e=document.getElementById("doctorName"),t=document.getElementById("consultant");if(!e||!t)return;e.innerHTML='<option value="">-- เลือกแพทย์ --</option>',t.innerHTML='<option value="">-- เลือกผู้ให้คำปรึกษา --</option>',userList.forEach(a=>{const n=document.createElement("option");n.value=a.id,n.textContent=a.name,"doctor"===a.role?.toLowerCase()?e.appendChild(n.cloneNode(!0)):"consultant"===a.role?.toLowerCase()&&t.appendChild(n.cloneNode(!0))})}function openTab(e){"receiptTab"!==e&&(currentlyViewedTransaction=null),document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-button").forEach(e=>e.classList.remove("active")),document.getElementById(e).classList.add("active"),document.querySelector(`.tab-button[onclick*="'${e}'"]`).classList.add("active")}function renderAllProductsTable(){const e=document.getElementById("allProductsBody");if(!e)return;const t=document.getElementById("searchProduct")?.value.toLowerCase()||"";let a=productList.filter(e=>(e.name&&e.name.toLowerCase().includes(t))||e.itemcode&&e.itemcode.toLowerCase().includes(t));a.sort((e,t)=>(e.itemcode||"").localeCompare(t.itemcode||""));const n=Math.ceil(a.length/allProductsPageSize),o=(allProductsCurrentPage-1)*allProductsPageSize,r=a.slice(o,o+allProductsPageSize);e.innerHTML=r.map(e=>`
//         <tr>
//             <td>${e.itemcode||"N/A"}</td>
//             <td>${e.name||"N/A"}</td>
//             <td>${formatCurrency(e.opd||0)}</td>
//             <td>${formatCurrency(e.ipd||0)}</td>
//             <td>${formatCurrency(e.foreign_opd||0)}</td>
//             <td>${formatCurrency(e.foreign_ipd||0)}</td>
//             <td>${formatCurrency(e.staff||0)}</td>
//             <td><button onclick="addItemToCart('${e.itemcode}')" style="padding: 5px 10px;">+</button></td>
//         </tr>
//     `).join(""),renderProductPagination(n)}function renderProductPagination(e){const t=document.getElementById("productPagination");if(!t||e<=1)return void(t&&(t.innerHTML=""));let a=`<button onclick="changeAllProductsPage(${allProductsCurrentPage-1})" ${1===allProductsCurrentPage?"disabled":""}>&laquo; ก่อนหน้า</button>`;for(let n=1;n<=e;n++)a+=`<button onclick="changeAllProductsPage(${n})" class="${n===allProductsCurrentPage?"active":""}">${n}</button>`;a+=`<button onclick="changeAllProductsPage(${allProductsCurrentPage+1})" ${allProductsCurrentPage===e?"disabled":""}>ถัดไป &raquo;</button>`,t.innerHTML=a}function changeAllProductsPage(e){const t=Math.ceil(productList.length/allProductsPageSize);e<1||e>t||(allProductsCurrentPage=e,renderAllProductsTable())}function searchProducts(){const e=document.getElementById("searchProduct"),t=document.getElementById("searchResults");if(!e||!t)return;const a=e.value.toLowerCase();if(a.length<1)return void(t.innerHTML="");const n=document.getElementById("patientType").value.toLowerCase(),o=productList.filter(e=>(e.name&&e.name.toLowerCase().includes(a))||e.itemcode&&e.itemcode.toLowerCase().includes(a));t.innerHTML=o.slice(0,10).map(e=>{const t=parseFloat(e[n]||0);return`<div class="search-item" onclick="addItemToCart('${e.itemcode}')">[${e.itemcode}] ${e.name} - <strong>${formatCurrency(t,2)}</strong></div>`}).join("")}function clearSearch(){const e=document.getElementById("searchProduct"),t=document.getElementById("searchResults");e&&(e.value=""),t&&(t.innerHTML=""),e&&e.focus()}function addItemToCart(e){const t=productList.find(t=>t.itemcode===e);if(!t)return void console.warn("Product not found for itemCode:",e);const a=document.getElementById("patientType").value.toLowerCase(),n=parseFloat(t[a]||0),o=shoppingCart.find(t=>t.itemcode===e);o?o.quantity++:shoppingCart.push({itemcode:t.itemcode,name:t.name,price:n,quantity:1}),updateCartDisplay(),clearSearch()}function updateCartDisplay(){const e=document.getElementById("cartItems");e&&(e.innerHTML=shoppingCart.map((e,t)=>`
//         <tr>
//             <td>${e.name}</td>
//             <td>${e.itemcode}</td>
//             <td>${formatCurrency(e.price)}</td>
//             <td><input type="number" min="1" value="${e.quantity}" onchange="updateQuantity(${t}, this.value)" style="width: 60px;"></td>
//             <td>${formatCurrency(e.price*e.quantity)}</td>
//             <td><button onclick="removeFromCart(${t})" style="background-color:#e74c3c; padding: 5px 10px;">X</button></td>
//         </tr>
//     `).join(""),updateBillingSummary())}function updateQuantity(e,t){const a=parseInt(t,10);isNaN(a)||a<=0?shoppingCart.splice(e,1):shoppingCart[e].quantity=a,updateCartDisplay()}function removeFromCart(e){shoppingCart.splice(e,1),updateCartDisplay()}function updateBillingSummary(){const e=shoppingCart.reduce((e,t)=>e+t.price*t.quantity,0),t=parseFloat(document.getElementById("depositAmount").value)||0,a=e-t;return document.getElementById("summaryGrandTotal").textContent=formatCurrency(e),document.getElementById("summaryDeposit").textContent=formatCurrency(t),document.getElementById("summaryOutstanding").textContent=formatCurrency(a),document.getElementById("cartTotal").textContent=formatCurrency(e),{productTotal:e,depositAmount:t,grandTotal:e,outstandingBalance:a}}function quickSearch(e){const t=document.getElementById("searchProduct");t&&(t.value=e,searchProducts())}async function generateReceipt(){if(!document.getElementById("firstName").value.trim())return void alert("กรุณากรอกชื่อจริง");if(signaturePad.isEmpty()||patientSignaturePad.isEmpty())return void alert("กรุณาลงลายเซ็นของผู้ให้คำปรึกษาและผู้ป่วยให้ครบถ้วน");const e=document.getElementById("doctorName"),t=document.getElementById("consultant"),a=document.getElementById("patientDob");currentPatientDetails={firstName:document.getElementById("firstName").value.trim(),lastName:document.getElementById("lastName").value.trim(),gender:document.getElementById("gender").value,patientHN:document.getElementById("patientHN").value.trim(),patientDob:a.value,patientAgeDisplay:a.dataset.displayAge||"N/A",type:document.getElementById("patientType").value,doctorId:e.value,doctorName:userList.find(t=>t.id===e.value)?.name||"N/A",consultantId:t.value,consultant:userList.find(e=>e.id===t.value)?.name||"N/A",paymentMethod:document.querySelector('input[name="paymentMethod"]:checked').value,reviewStatus:Array.from(document.querySelectorAll('input[name="reviewStatus"]:checked')).map(e=>e.value).join(","),comment:document.getElementById("comment").value.trim(),consultantSignature:consultantSignatureBase64,patientSignature:patientSignatureBase64};const n="TXN-"+Date.now(),o=await saveTransaction(n);o&&(showSuccessNotification(`บันทึกข้อมูลสำเร็จ! (ID: ${n})`),populateReceiptForDisplay(n,currentPatientDetails,shoppingCart),openTab("receiptTab"))}async function saveTransaction(e){const t=updateBillingSummary(),a={transaction_id:e,fname:currentPatientDetails.firstName,lname:currentPatientDetails.lastName,gender:currentPatientDetails.gender,patient_hn:currentPatientDetails.patientHN,patient_dob:currentPatientDetails.patientDob,date:(new Date).toISOString(),type:currentPatientDetails.type,cartItems:shoppingCart.map(e=>({itemcode:e.itemcode,quantity:e.quantity,price:e.price})),total:t.productTotal,doctor_id:currentPatientDetails.doctorId,consultant_id:currentPatientDetails.consultantId,doctor_name:currentPatientDetails.doctorName,consultant_name:currentPatientDetails.consultant,deposit_amount:t.depositAmount,outstanding_balance:t.outstandingBalance,payment_method:currentPatientDetails.paymentMethod,review_status:currentPatientDetails.reviewStatus,comment:currentPatientDetails.comment,consultant_signature_b64:currentPatientDetails.consultantSignature,patient_signature_b64:currentPatientDetails.patientSignature};try{const e=await fetch("/api/save-transaction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await e.json();if(!e.ok)throw new Error(n.message||"Server error");return await loadTransactionHistory(),!0}catch(e){return console.error("Error saving transaction:",e),alert("ไม่สามารถบันทึกการทำรายการได้: "+e.message),!1}}function populateReceiptForDisplay(e,t,a,n=null){const o=document.getElementById("receipt"),r=document.querySelector("#receiptTab .receipt-preview-container");if(!o||!r)return;const c=o.cloneNode(!0);c.id="receipt_display",c.classList.remove("print-area");const i=c.querySelector("h2");if(i){const t=document.createElement("div");t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center";const a=document.createElement("h2");a.textContent=i.textContent;const n=document.createElement("i");n.className="fas fa-cog",n.title="แก้ไขรายการ",n.style.cursor="pointer",n.style.fontSize="1.5rem",n.onclick=()=>{const t=document.getElementById("login-modal");t&&(t.dataset.redirectUrl=`/edit/${e}`,t.style.display="flex")},t.appendChild(a),t.appendChild(n),i.parentNode.replaceChild(t,i)}r.innerHTML="",r.appendChild(c),populatePrintableData(c.id,e,t,a,n)}function populatePrintableData(e,t,a,n,o){const r=document.getElementById(e);if(!r)return;const c=o?{productTotal:parseFloat(o.total||0),depositAmount:parseFloat(o.deposit_amount||0),outstandingBalance:parseFloat(o.outstanding_balance||0)}:updateBillingSummary(),i={receiptId:t,receiptDate:new Date(o?o.date:Date.now()).toLocaleString("th-TH"),receiptName:`${a.firstName||""} ${a.lastName||""}`,receiptHN:a.patientHN||"N/A",receiptGender:a.gender||"N/A",receiptAge:a.patientAgeDisplay||calculateAge(a.patientDob)||"N/A",receiptType:a.type,receiptDoctor:a.doctorName,receiptConsultant:a.consultant,receiptPaymentMethod:a.paymentMethod||"N/A",receiptReviewStatus:a.reviewStatus||"N/A",receiptSubtotal:c.productTotal.toFixed(2),receiptGrandTotal:c.productTotal.toFixed(2),receiptDeposit:c.depositAmount.toFixed(2),receiptOutstanding:c.outstandingBalance.toFixed(2),comment:a.comment||"N/A"};for(const e in i){const t=r.querySelector(`[data-field="${e}"]`);t&&(t.textContent=["receiptSubtotal","receiptGrandTotal","receiptDeposit","receiptOutstanding"].includes(e)?parseFloat(i[e]).toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2}):i[e])}const l=r.querySelector('[data-field="receiptConsultantSignature"]');if(l){const e=o?.consultant_signature_filename?`/static/signatures/${o.consultant_signature_filename}`:o?.consultant_signature_b64||a.consultantSignature;e?(l.src=e,l.style.display="block"):(l.style.display="none")}const s=r.querySelector('[data-field="receiptPatientSignature"]');if(s){const e=o?.patient_signature_filename?`/static/signatures/${o.patient_signature_filename}`:o?.patient_signature_b64||a.patientSignature;e?(s.src=e,s.style.display="block"):(s.style.display="none")}const d=r.querySelector("#receiptItemsTable_print tbody");d&&(d.innerHTML=n.map(e=>`
//             <tr>
//                 <td>${e.name}</td>
//                 <td>${e.itemcode}</td>
//                 <td>${formatCurrency(e.price||0)}</td>
//                 <td>${e.quantity}</td>
//                 <td>${formatCurrency((e.price||0)*e.quantity)}</td>
//             </tr>`).join(""))}function printMainReceipt(){const e=!!currentlyViewedTransaction;let t,a,n,o=null;if(e)o=currentlyViewedTransaction,a=Array.isArray(o.products_list)?o.products_list:[],n=o.transaction_id,t={...o,firstName:o.fname,lastName:o.lname,patientAgeDisplay:("N/A"!==calculateAge(o.patient_dob)?`${calculateAge(o.patient_dob)} ปี`:"N/A"),doctorName:o.doctor_name,consultant:o.consultant_name,consultantSignature:o.consultant_signature_b64,patientSignature:o.patient_signature_b64};else t=currentPatientDetails,a=shoppingCart,n=document.querySelector('#receipt_display [data-field="receiptId"]')?.textContent||"N/A";populatePrintableData("receipt",n,t,a,o),window.print()}function resetFlow(){document.getElementById("mainTab").querySelectorAll("input, select, textarea").forEach(e=>{"radio"===e.type&&"payCash"===e.id?e.checked=!0:"checkbox"===e.type?e.checked=!1:"SELECT"===e.tagName?e.selectedIndex=0:e.value=""}),document.getElementById("depositAmount").value="0",updatePatientAgeDisplay(),shoppingCart=[],currentPatientDetails={},currentlyViewedTransaction=null,clearSignature(),clearPatientSignature(),clearSearch(),updateCartDisplay(),openTab("mainTab"),document.getElementById("firstName").focus()}async function loadTransactionHistory(){try{const e=await fetch("/api/transaction-history");e.ok?transactionHistory=await e.json()||[]:transactionHistory=[],searchHistory()}catch(e){console.error("Error loading transaction history:",e),transactionHistory=[],searchHistory()}}function searchHistory(){const e=document.getElementById("historySearch").value.toLowerCase(),t=document.getElementById("historyResults");if(!t)return;const a=[...transactionHistory].sort((e,t)=>new Date(b.date)-new Date(a.date)),n=a.filter(t=>Object.values(t).some(t=>String(t).toLowerCase().includes(e)));historyCurrentPage=1,renderHistoryPage(n)}function renderHistoryPage(e){const t=document.getElementById("historyResults"),a=Math.ceil(e.length/historyPageSize),n=(historyCurrentPage-1)*historyPageSize,o=e.slice(n,n+historyPageSize);0===o.length?t.innerHTML="<p>ไม่พบประวัติการทำรายการ</p>":t.innerHTML=o.map(e=>{const t=calculateAge(e.patient_dob);return`
//             <div onclick="viewReceiptFromHistory('${e.transaction_id}')" style="padding: 10px; border: 1px solid #ddd; margin-bottom: 5px; cursor: pointer; border-radius: 8px;">
//                 <strong>${e.fname||""} ${e.lname||""}</strong> (HN: ${e.patient_hn||"N/A"}) (อายุ: ${"N/A"!==t?t:"N/A"})
//                 <div style="float: right;">ค้างชำระ: <strong style="color: #c0392b;">${formatCurrency(e.outstanding_balance||0)}</strong></div>
//                 <div style="font-size:0.9em; color: #555;">ID: ${e.transaction_id} | วันที่: ${new Date(e.date).toLocaleDateString("th-TH")}</div>
//             </div>`}).join(""),renderHistoryPagination(a,e)}function renderHistoryPagination(e,t){const a=document.getElementById("historyPagination");if(!a||e<=1)return void(a&&(a.innerHTML=""));let n=`<button onclick="changeHistoryPage(-1, ${e})" ${1===historyCurrentPage?"disabled":""}>&laquo;</button>`;n+=`<span> หน้า ${historyCurrentPage} / ${e} </span>`,n+=`<button onclick="changeHistoryPage(1, ${e})" ${historyCurrentPage===e?"disabled":""}>&raquo;</button>`,a.innerHTML=n,a.querySelector("button:first-child").onclick=()=>changeHistoryPage(historyCurrentPage-1,e,t),a.querySelector("button:last-child").onclick=()=>changeHistoryPage(historyCurrentPage+1,e,t)}function changeHistoryPage(e,t,a){e<1||e>t||(historyCurrentPage=e,renderHistoryPage(a))}function viewReceiptFromHistory(e){const t=transactionHistory.find(t=>t.transaction_id===e);if(!t)return void alert("ไม่พบการทำรายการนี้!");currentlyViewedTransaction=t;const a=Array.isArray(t.products_list)?t.products_list:[],n=calculateAge(t.patient_dob),o={firstName:t.fname,lastName:t.lname,gender:t.gender,patientHN:t.patient_hn||"N/A",patientDob:t.patient_dob,patientAgeDisplay:"N/A"!==n?`${n} ปี`:"N/A",type:t.type,doctorName:t.doctor_name||"N/A",consultant:t.consultant_name||"N/A",paymentMethod:t.payment_method,reviewStatus:t.review_status,comment:t.comment,consultantSignature:t.consultant_signature_b64,patientSignature:t.patient_signature_b64};populateReceiptForDisplay(t.transaction_id,o,a,t),openTab("receiptTab")}function setupLoginModal(){const e=document.getElementById("login-icon"),t=document.getElementById("login-modal"),a=document.querySelector(".modal-close-button"),n=document.getElementById("login-form"),o=document.getElementById("login-error-message");!e||!t||!a||!n||(e.addEventListener("click",()=>{t.dataset.redirectUrl="/crud",t.style.display="flex",o.style.display="none",n.reset()}),a.addEventListener("click",()=>t.style.display="none"),t.addEventListener("click",e=>{e.target===t&&(t.style.display="none")}),n.addEventListener("submit",async e=>{e.preventDefault();const a=e.target.username.value,r=e.target.password.value;o.style.display="none";try{const e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:r})}),c=await e.json();if(e.ok&&"success"===c.status){showSuccessNotification("เข้าสู่ระบบสำเร็จ!");t.style.display="none";const a=t.dataset.redirectUrl||c.redirect_url;setTimeout(()=>{window.location.href=a},1e3)}else o.textContent=c.message||"เกิดข้อผิดพลาด",o.style.display="block"}catch(e){o.textContent="ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้",o.style.display="block"}}))}